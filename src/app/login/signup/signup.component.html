<!-- signup.component.html -->
<section class="min-h-screen bg-zinc-900 flex items-center justify-center px-4 py-8">
  <div class="grid md:grid-cols-2 w-full max-w-5xl rounded-xl overflow-hidden shadow-md bg-white">
    <!-- Hero Section -->
    <div class="hidden md:block">
      <app-login-hero></app-login-hero>
    </div>

    <!-- Form Section -->
    <div class="p-6 md:p-10">
      <h2 class="text-2xl font-bold mb-2 text-gray-800">Create Your Account</h2>
      <p class="text-red-600 italic mb-4">
        <a [routerLink]="['/quick-sign-up']">Quick signup with email</a>
      </p>
      <p class="text-sm text-red-600 font-semibold mb-6">Step {{ formIndex + 1 }} of 3</p>

      <form [formGroup]="signupForm" (ngSubmit)="handleNextOrSubmit()" class="space-y-6">

        <!-- STEP 1: Name, Gender, DOB, Photo -->
        <div *ngIf="formIndex === 0" class="space-y-4">
          <div *ngIf="invalidForm && !isStepValid(0)" class="p-2 bg-red-100 text-red-700 rounded-md text-sm">
            Please complete all fields in this section.
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <input formControlName="firstname" placeholder="First Name"
                class="w-full px-4 py-3 rounded-md border focus:outline-none"
                [ngClass]="{'border-red-600': f('firstname').invalid && f('firstname').dirty, 'border-gray-300': f('firstname').valid}" />
              <div *ngIf="f('firstname').invalid && f('firstname').dirty" class="text-xs text-red-500 mt-1">First name
                is required</div>
            </div>
            <div>
              <input formControlName="lastname" placeholder="Last Name"
                class="w-full px-4 py-3 rounded-md border focus:outline-none"
                [ngClass]="{'border-red-600': f('lastname').invalid && f('lastname').dirty, 'border-gray-300': f('lastname').valid}" />
              <div *ngIf="f('lastname').invalid && f('lastname').dirty" class="text-xs text-red-500 mt-1">Last name is
                required</div>
            </div>
          </div>

          <!-- DOB -->
          <div>
            <input formControlName="dob" type="date" class="w-full px-4 py-3 rounded-md border focus:outline-none"
              [ngClass]="{'border-red-600': f('dob').invalid && f('dob').dirty, 'border-gray-300': f('dob').valid}" />
            <div *ngIf="f('dob').invalid && f('dob').dirty" class="text-xs text-red-500 mt-1">
              Please select your birth date
            </div>
          </div>

          <!-- Gender -->
          <div class="flex gap-4">
            <label
              class="flex-1 text-center py-2 rounded-full border cursor-pointer transition hover:bg-red-600 hover:text-white"
              [class.bg-red-600]="signupForm.value.gender==='Male'"
              [class.text-white]="signupForm.value.gender==='Male'">
              <input type="radio" formControlName="gender" value="Male" class="opacity-0 absolute" /> Male
            </label>
            <label
              class="flex-1 text-center py-2 rounded-full border cursor-pointer transition hover:bg-red-600 hover:text-white"
              [class.bg-red-600]="signupForm.value.gender==='Female'"
              [class.text-white]="signupForm.value.gender==='Female'">
              <input type="radio" formControlName="gender" value="Female" class="opacity-0 absolute" /> Female
            </label>
          </div>
          <div *ngIf="f('gender').invalid && f('gender').dirty" class="text-xs text-red-500 mt-1">
            Please select a gender
          </div>

          <!-- Profile Photo -->
          <div class="flex flex-col items-center">
            <label class="block mb-1 font-semibold">Profile Photo</label>
            <div
              class="w-32 h-32 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center cursor-pointer hover:border-red-600 transition relative overflow-hidden">
              <input type="file" accept="image/*" (change)="onImgSelected($event)"
                class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
              <img *ngIf="imagePreview; else cameraIcon" [src]="imagePreview" alt="Profile preview"
                class="object-cover w-full h-full rounded-md" />
              <ng-template #cameraIcon>
                <feather-icon name="camera" class="w-6 h-6 text-gray-400"></feather-icon>
              </ng-template>
            </div>
            <button *ngIf="imagePreview" type="button" (click)="removeImage()"
              class="mt-2 text-xs text-red-600 hover:underline">
              Remove
            </button>
            <app-validation-message
              *ngIf="f('profilePhoto').touched && f('profilePhoto').invalid && !selectedImage && !imagePreview"
              [control]="f('profilePhoto')" [message]="'Profile photo is required'">
            </app-validation-message>
            <app-validation-message *ngIf="f('profilePhoto').errors?.['fileTooLarge']" [control]="f('profilePhoto')"
              [message]="'Image must be under 2MB'">
            </app-validation-message>
          </div>
        </div>

        <!-- STEP 2: Location Component -->
        <div *ngIf="formIndex === 1" class="space-y-4">
          <app-location-form [form]="locationForm" #locationFormComponent></app-location-form>

        </div>

        <!-- STEP 3: Email + Password -->
        <div *ngIf="formIndex === 2" class="space-y-4">
          <div *ngIf="invalidForm && !isStepValid(2)" class="p-2 bg-red-100 text-red-700 rounded-md text-sm">
            Please complete all fields in this section.
          </div>

          <div>
            <input formControlName="email" type="email" placeholder="Email address"
              class="w-full px-4 py-3 rounded-md border focus:outline-none"
              [ngClass]="{'border-red-600': f('email').invalid && f('email').dirty, 'border-gray-300': f('email').valid}" />
            <div *ngIf="f('email').invalid && f('email').dirty" class="text-xs text-red-500 mt-1">
              Valid email is required
            </div>
          </div>

          <div>
            <input formControlName="password" type="password" placeholder="Password"
              class="w-full px-4 py-3 rounded-md border focus:outline-none"
              [ngClass]="{'border-red-600': f('password').invalid && f('password').dirty, 'border-gray-300': f('password').valid}" />
            <div *ngIf="f('password').invalid && f('password').dirty" class="text-xs text-red-500 mt-1">
              Password must be at least 8 chars
            </div>
          </div>

          <div>
            <input formControlName="confirmPassword" type="password" placeholder="Confirm Password"
              class="w-full px-4 py-3 rounded-md border focus:outline-none"
              [ngClass]="{'border-red-600': signupForm.hasError('passwordMismatch') && f('confirmPassword').dirty, 'border-gray-300': f('confirmPassword').valid}" />
            <div *ngIf="signupForm.hasError('passwordMismatch') && f('confirmPassword').dirty"
              class="text-xs text-red-500 mt-1">Passwords do not match</div>
          </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="flex justify-between">
          <button type="button" (click)="prevStep()" [disabled]="formIndex === 0"
            class="px-4 py-2 rounded-md bg-gray-300 text-gray-700 disabled:opacity-50">
            Prev
          </button>
          <button type="submit" [disabled]="!isStepValid(formIndex)"
            class="px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700 disabled:opacity-50">
            {{ formIndex < 2 ? 'Next' : 'Submit' }} </button>
        </div>
      </form>
    </div>
  </div>
</section>